# 이미지 업로드 기능 테스트 가이드

## 준비사항

### 1. Supabase Storage 설정 (선택)
- Storage 버킷 생성 필요 시: `docs/IMAGE_UPLOAD_SETUP.md` 참조
- 버킷이 없어도 Mock URL로 개발 가능

### 2. 테스트 계정
- **자산 1.5억 이상** 계정 필요 (글쓰기 권한)
- 테스트 모드: `src/config/freePeriod.ts`에서 무료 기간 활성화

## 테스트 시나리오

### 시나리오 1: 이미지 선택 및 유효성 검사

1. 앱 실행 → VIP 라운지 → 글쓰기 버튼
2. "이미지 첨부 (선택)" 섹션 확인
3. "이미지 선택" 버튼 탭
4. 갤러리 권한 요청 → 허용
5. 이미지 선택 (최대 3장)

**예상 결과:**
- 선택된 이미지가 썸네일로 표시됨
- 각 썸네일에 파일 크기 표시 (예: "2.3 MB")
- X 버튼으로 이미지 삭제 가능
- 3장 선택 후 "이미지 선택" 버튼 숨김

### 시나리오 2: 파일 크기 제한 테스트

1. 5MB 이상 이미지 선택
2. 에러 메시지 확인: "이미지 크기는 5MB 이하여야 합니다."

**예상 결과:**
- Alert 표시 후 이미지 선택 취소

### 시나리오 3: MIME 타입 제한 테스트

1. GIF, WebP 등 지원되지 않는 형식 선택 시도

**예상 결과:**
- Alert: "JPEG 또는 PNG 이미지만 업로드 가능합니다."

### 시나리오 4: 게시글 작성 (이미지 포함)

1. 카테고리 선택 (주식/코인/부동산)
2. 본문 입력 (10자 이상)
3. 이미지 1~3장 선택
4. "작성" 버튼 탭

**예상 결과:**
- "이미지 업로드 중..." 표시
- 업로드 완료 후 게시글 작성
- 커뮤니티 목록에서 썸네일 확인 (120x120)
- 게시글 상세에서 큰 이미지 확인 (화면 너비 70%)

### 시나리오 5: 이미지 없이 작성

1. 카테고리 + 본문만 입력
2. "작성" 버튼 탭

**예상 결과:**
- 이미지 업로드 과정 생략
- 정상 게시글 작성

### 시나리오 6: 게시글 상세 이미지 확인

1. 이미지가 있는 게시글 탭
2. 이미지 갤러리 확인 (가로 스크롤)
3. 이미지 탭

**예상 결과:**
- 이미지가 본문 아래에 표시
- 가로 스크롤로 여러 이미지 확인 가능
- 이미지 탭 시 Alert: "이미지 1/3" (향후 확대 모달 구현 예정)

### 시나리오 7: Mock Mode 테스트 (Supabase 없이)

1. Supabase Storage 버킷 없는 상태에서 게시글 작성
2. 콘솔 확인: "Storage bucket not found. Returning mock URL for development."

**예상 결과:**
- Mock URL 반환: `https://mock-storage.baln.app/...`
- UI는 정상 작동 (실제 이미지는 표시 안 됨)

## 체크리스트

- [ ] 갤러리 권한 요청 정상 작동
- [ ] 이미지 선택 (1~3장)
- [ ] 파일 크기 제한 (5MB) 작동
- [ ] MIME 타입 제한 (JPEG, PNG) 작동
- [ ] 썸네일 미리보기 표시
- [ ] 이미지 삭제 (X 버튼) 작동
- [ ] 업로드 진행 표시 ("이미지 업로드 중...")
- [ ] 게시글 작성 후 목록에서 썸네일 확인
- [ ] 게시글 상세에서 큰 이미지 확인
- [ ] 이미지 없이 작성 가능
- [ ] Mock Mode (버킷 없을 때) 정상 작동

## 트러블슈팅

### 이미지가 표시되지 않음
- Mock URL인지 확인 (콘솔 경고 확인)
- Supabase Storage RLS 정책 확인
- 이미지 URL이 `https://` 시작하는지 확인

### 업로드 실패
- 네트워크 연결 확인
- Supabase Storage 버킷 존재 확인
- RLS 정책 (INSERT) 확인

### 권한 에러
- 갤러리 접근 권한 재확인 (설정 앱)
- iOS: `Info.plist`에 `NSPhotoLibraryUsageDescription` 확인
- Android: `AndroidManifest.xml`에 `READ_MEDIA_IMAGES` 확인

### TypeScript 에러
- `supabase` import 확인: `import supabase from './supabase'` (default export)

## 향후 개선 사항

이번 구현에서 제외된 기능 (Phase 2로 이관):
- [ ] 이미지 확대 모달 (pinch-to-zoom)
- [ ] 이미지 편집 (크롭, 필터)
- [ ] 이미지 압축 (자동)
- [ ] 썸네일 자동 생성 (Edge Function)
- [ ] 드래그 앤 드롭 재정렬
- [ ] 진행률 표시 (0-100%)
- [ ] 여러 이미지 동시 선택 (iOS 14+)

## 성능 메트릭

예상 성능:
- 이미지 선택: < 500ms
- 업로드 (2MB × 3장): 3-5초 (4G 환경)
- 썸네일 렌더링: < 100ms (캐시 히트)

## 보안 체크

- [x] EXIF 데이터 제거 (개인정보 보호)
- [x] 파일 크기 제한 (DoS 방지)
- [x] MIME 타입 검증 (악성 파일 차단)
- [x] 경로 격리 (`userId/postId/...`)
- [x] RLS 정책 (본인만 업로드/삭제)
